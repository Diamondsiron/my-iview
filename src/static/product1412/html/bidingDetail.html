<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script src="../js/vue.min.js"></script>
  <script src="../js/axios.min.js"></script>
  <script src="../js/bscroll.min.js"></script>
  <script src="../js/axios.config.js"></script>
  <link rel="stylesheet" href="../css/binding.css">
</head>
<body>
  <div class="wrapper" id="main">
      <div class="toast" id="toast">
          {{hint}}
        </div>
    <div class="content">
      <div >
       
          <div id="top" style="display: block;overflow: hidden;" class="top">
              <div class="card">
                  <div>
                    年化利率
                  </div>
                  <div>
                   
                  </div>
                  <div>
                   
                    <span class="card-font-1"> {{value2}}</span><span class="card-font-2">%+</span><span class="card-font-3">{{value3}}</span><span class="card-font-4">%</span>
                  </div>
                  <div>资金由江西银行全程存管</div>
                  
                    <div class="card-bottom">
                      <div class="card-bottom-l">
                        <div>服务期限{{objData.sellInfo.ExpiresDays}}天</div> 
                      </div>
                      <div class="card-bottom-r">
                        <div>
                          <div>剩余可出借（元）</div>
                          <div>{{objData.selllimitconfig.RestMoney}}</div>
                        </div>
                      </div>
                    </div>
                </div>
               
                  <div class="table"></div>
                  <div class="table-desc">
                    <div>
                      <div class="font1">今日出借</div>
                      <div class="font2">立即匹配</div>
                    </div>
                    <div>
                      <div class="font1">匹配成功</div>
                      <div class="font2">开始计息</div>
                    </div>
                    <div>
                      <div class="font1">到期转出</div>
                      <div class="font2">{{objData.sellInfo.Endday}}</div>
                    </div>
                    
                  </div>
               
                <div class="context">
                  <div class="context-title">出借金额（元）</div>
                  <div class="context-input">
                    <input id="text" class="context-input-text" type="text" pattern="[0-9]*"  v-model="count" v-on:input="dispear()"  v-on:blur="apear()" >
                    <label id="label" class="context-input-lable" v-on:click="labelClick()" >{{text1}}</label>
                  </div>
                  
                
                  
                  <div>
                    <div>
                    
                      预期回报
                  
                 
                </div>
                <div>
                
                      {{income}}元
                  
                </div>
                  </div>
                  
                  
                  <div>
                    (参考历史数据得出，以实际到账为准)
                  </div>
                </div>
                <footer class="top-footer">
                  <div class="foot-touch" id="touch">
                    -向上滑动，查看更多详情-
                  </div>
                  <div class="foot-title">
                      出借即表示同意<a href="javascript:void(0)">《出借咨询及信息管理服务协议》</a>、<a href="javascript:void(0)">《风险提示书》</a>
                   
                  </div>
                  <div class="foot-content">
                      <button ontouchstart="" class="foot-content-btn" @click="submit()" v-bind:class="{clickable:!clickable}">立即出借</button>
                  </div>
                </footer>
          </div>
         
          
          <div style="display: none;" id="bottom" class="bottom"  >
            <header>
              <div class="head-content" id="head-content">
                <div class="head-content-item " v-on:click="changeCurrent(1)" :class={"head-content-item_choose":choose==1}>服务介绍</div>
                <div  class="head-content-item " v-on:click="changeCurrent(2)" :class={"head-content-item_choose":choose==2}>标的组成</div>
                <div  class="head-content-item" v-on:click="changeCurrent(3)" :class={"head-content-item_choose":choose==3}>加入记录</div>
              </div>
            </header>
            <div id="choose1" v-if="choose==1">
                <div class="context">
                    <div class="context-desc">
                      <p>服务名称：{{objData.sellInfo.SellName}}</p>
                      <p>筹集期限：3个工作日</p>
                      <p>期待年回报率：{{value1}}%，包含基础年化利率{{value2}}%+出借奖励{{value3}}%</p>
                      <p>服务年限：{{objData.sellInfo.ExpiresDays}}天</p>
                      <p>出借范围：车辆抵押借款标、信用借款标</p>
                      <p>出借金额：出借金额{{objData.sellInfo.MinInvestMoney}}元起</p>
                      <p>出借时间：{{objData.sellInfo.validtime}}</p>
                      <p>预计起息日期：{{objData.sellInfo.nowDate}}，具体以匹配完成时间为准</p>
                      <p>账户管理费：单笔标的利息的{{value4}}%</p>
                      <p>提前转出：服务期满{{objData.sellInfo.AdvanceDays}}天后可申请提前转出</p>
                      <p>提前转出服务费：转出本金的{{value5}}%</p>
                    </div>
                    <div class="context-safety">
                      <div class="context-title">
                       <p>安全保障</p> 
                      </div>
                      <div class="context-line"></div>
                    </div>
                    <div class="context-safety-desc">
                      <div>
                          <img src="../image/sy_18.gif" alt="">
                      </div>
                      <div>
                          <img src="../image/sy_19.gif" alt="">
                      </div>
                      <div>
                        <img src="../image/sy_20.gif" alt="">
                      </div>
                    </div>
                    <div class="context-serve">
                      <div class="context-title">
                        <p>服务说明</p> 
                      </div>
                      <div class="context-line"></div>
                    </div>
                    <div class="context-serve-desc">
                      <p>
                        用户在申请出借后资金会被冻结，系统会在用户授权范围内，为用户匹配通过平台评估审核合格，并符合用户风险评级结果的借款标的或债权装让标的；
                        在用户无异议的情况下，平台在用户已授权的情况下，利用电子签章与存证服务系统为出借、借款或债券转让用户双方生成电子签章，以备服务器永久储存。
                        同时，出借资金划拨至借款人或债券转让人在江西银行开立的账户中，形成债权债务关系。若匹配失败，出借资金将解冻，可由出借用户自由支配。
                      </p>
                    </div>
                    <div class="context-advanced">
                        <div class="context-title">
                            <p>提前转出</p> 
                          </div>
                          <div class="context-line"></div>
                    </div>
                    <div class="context-advanced-desc">
                      <p>
                        除指定服务外，服务满30天后，您可申请提前转出。平台处理提前转出的债务周期一般为自用户提交之日起的3个工作日，如未能在发起日后3个工作日内
                        转让退出成功，用户将继续持有该债权。具体转让完成时间视市场交易情况而定。
                      </p>
                    </div>
                    <div class="context-theory">
                        <div class="context-title">
                            <p>原理图</p> 
                          </div>
                          <div class="context-line"></div>
                    </div>
                    <div class="context-theory-desc">
                      <img src="../image/cp_11.png" alt="展示图片">
                    </div>
                </div>
                <footer style="overflow: hidden;">
                  <div class="foot-title">
                    出借即表示同意<a href="javascript:void(0)">《出借咨询及信息管理服务协议》</a>、<a href="javascript:void(0)">《风险提示书》</a>
                  </div>
                  <div class="foot-content">
                      <button ontouchstart="" class="foot-content-btn" v-bind:class="{clickable:!clickable}">立即出借</button>
                  </div>
                  
                </footer>
            </div>
            <div id="choose2" v-if="choose==2" >
                <div class="context" >
                    <div class="context-title">为保护借款人信息仅展示部分内容，具体匹配以实际情况为准。</div>
                    <div class="wrappers">
                      <div class="contents">
                        <div class="context-table-wrap ">
                          <table class="context-table">
                            <tr>
                              <th>借款标的</th>
                              <th>类型</th>
                              <th>剩余金额（元）</th>
                              <th></th>
                            </tr>
                            <tr v-for="(item,index) in listConstitute" ::key="index">
                              <td>{{item.description}}</td>
                              <td>{{item.borrowtypeid | type}}</td>
                              <td>{{item.originalamount}}</td>
                              <td v-on:click="nextPage(item.typeid,item.borrowid,item.relationid)">></td>
                            </tr>
                            
                          
                          </table>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                  <footer style="overflow: hidden;">
                    <div class="foot-title">
                      出借即表示同意<a href="javascript:void(0)">《出借咨询及信息管理服务协议》</a>、<a href="javascript:void(0)">《风险提示书》</a>
                    </div>
                    <div class="foot-content">
                        <button ontouchstart="" class="foot-content-btn" v-bind:class="{clickable:!clickable}">立即出借</button>
                    </div>
                    
                  </footer>
            </div>
            <div id="choose3" v-if="choose==3">
                <div class="context">
                    <div class="context-title"></div>
                    <div class="wrapperss" >
                      <div class="contentss" >
                        <div class="context-table-wrap">
                          <table class="context-table">
                            <tr>
                              <th>出借人</th>
                              <th>加入金额（元）</th>
                              <th>加入期限</th>
                              <th>加入时间</th>
                            </tr>
                            <tr v-for="(item,index) in listRecord" :key="index">
                              <td>{{item.Phone}}</td>
                              <td>{{item.ContractAmount}}</td>
                              <td>{{item.ExpiresDays}}天</td>
                              <td>{{item.StartTime}}</td>
                            </tr>
                           
                           
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <footer style="overflow: hidden;">
                    <div class="foot-title">
                      出借即表示同意<a href="javascript:void(0)">《出借咨询及信息管理服务协议》</a>、<a href="javascript:void(0)">《风险提示书》</a>
                    </div>
                    <div class="foot-content">
                        <button ontouchstart="" class="foot-content-btn" v-bind:class="{clickable:!clickable}">立即出借</button>
                    </div>
                    
                  </footer>
            </div>
           
          </div>
        </div>
      </div>
  </div>


<script>
   document.documentElement.style.fontSize = document.documentElement.clientWidth / 1242*100 + 'px';
  var vm = new Vue({
    el:"#main",
    data(){
      return{
        value1:"",
        value2:"",
        value3:"",
        value4:"",
        value5:"",
        text1:"",
        count:"",
        income:'',
        h1:"",
        h2:"",
        list:[0,1,2,3,4,5,6,7,8,9,10,11],
        hint:"最多20万",
        choose:1,
        scroll:{},
        scrolls:{},
        constitutePage:"1",
        recordPage:"1",
        scrollss:{},
        clickable:true,
        listConstitute:[],
        listRecord:[],
        RNmessage:{},
        objData:{
                fundAccountInfo: {
                  AccountId: "",
                  SignStatus: null,
                  BankNo: "",
                  Id: "",
                  TradePasswordStatus: ""
                },
                return_msg: "",
                sellInfo: {
                  ImproveRate: null,
                  InvestMaxTimes: null,
                  EndTime: "",
                  MinInvestMoney: "",
                  SellLimitConfigId: "",
                  ProductId: "",
                  OrderNo: "",
                  ProductMaxMoney: null,
                  InComeType: "",
                  ProductFirstAwardRate: "",
                  ProductConfigId: "",
                  AdvanceWay: "",
                  IntorduceLimit:"",
                  LabelText: "",
                  ActivityRuleIds: null,
                  AdvanceWayValue: "",
                  ActivateIntegralRate: "",
                  IntorduceInvestRate:"",
                  Status: "",
                  ExpectedYearYield: "",
                  SellName: "",
                  InvestMaxMoney: "",
                  InputPerson: "",
                  AccountFeeRate: "",
                  InputTime: "",
                  StartTime: "",
                  RatingLevelId: "",
                  IncrementMoney: "",
                  SelfInvestRate: "",
                  validtime: "",
                  ProductTypeId: "",
                  PromptText: "",
                  AdvanceDays: "",
                  Intro: "",
                  ProductMaxTimes: null,
                  ImproveYearRate: "",
                  buyStatus: "",
                  ExpiresDays: "",
                  Endday: "",
                  Id: "",
                  ExpectedYield: null,
                  SellConfigId: "",
                  SendIntegralRate: "",
                  LastTime: null
                },
                return_code: "",
                selllimitconfig: {
                  Status: "",
                  SellAmount: "",
                  InputPerson:"",
                  SellStatus: "",
                  InputTime: "",
                  GroupId: null,
                  BuyKey: null,
                  SellCreateDate: "",
                  Type: "",
                  ProductConfigId: "",
                  SellDate: "",
                  Id: "",
                  RestMoney: ""
                }
              }

      }
    },
    watch:{
      count:function(){
        if(this.count>200000){
          
          this.count=200000
          this.showToastZoom()
          return
        }else{
          this.income = (((Math.floor(this.count/100)*100*(this.objData.sellInfo.ImproveYearRate + this.objData.sellInfo.ExpectedYearYield)*this.objData.sellInfo.ExpiresDays)/365).toFixed(2));
        }
        
      }
    },
    filters:{
      type(value){
        if(value==1){
          return "信贷"
        }else{
          return "抵押贷"
        }
      }
    },
    methods:{
      submit(){
        //if(this.objData.sellInfo.buyStatus!=="0"){
        if(false){
           return
          }else{
           this.submitData() 
        }
      },
      dispear(){
        document.getElementById("label").style.display = 'none';
      },
      apear(){
        if(this.count == ""){
          document.getElementById("label").style.display = 'block';
        }
       
      },
      labelClick(){
        document.getElementById("text").focus();
      },
      nextPage(value,borrowid,relationid){
        //转让标
        if(value==0){
          window.location.href="http://10.2.0.155:8099/JYD_RN_Serv/productJoinRecord/jumpBiaodiDetail?"+"typeid="+0+"&borrow_id="+borrowid+"&relationid="+relationid+"&jyd_pubData.user_id="+this.RNmessage.jyd_pubData.user_id+"&jyd_pubData.source_type="+this.RNmessage.jyd_pubData.source_type+"&jyd_pubData.system_id="+this.RNmessage.jyd_pubData.system_id+"&jyd_pubData.network_type="+this.RNmessage.jyd_pubData.network_type+"&jyd_pubData.token_id="+this.RNmessage.jyd_pubData.token_id   
         
        }else if(value==1){
          //二手标
          window.location.href="http://10.2.0.155:8099/JYD_RN_Serv/productJoinRecord/jumpBiaodiDetail?"+"typeid="+1+"&borrow_id="+borrowid+"&relationid="+relationid+"&jyd_pubData.user_id="+this.RNmessage.jyd_pubData.user_id+"&jyd_pubData.source_type="+this.RNmessage.jyd_pubData.source_type+"&jyd_pubData.system_id="+this.RNmessage.jyd_pubData.system_id+"&jyd_pubData.network_type="+this.RNmessage.jyd_pubData.network_type+"&jyd_pubData.token_id="+this.RNmessage.jyd_pubData.token_id   
        }
      },
      submitData(){
        let vms = this
        let req = {
                  "tel_phone": this.RNmessage.tel_phone, 
                  "sell_id": this.objData.sellInfo.Id, 
                    "jyd_pubData": {
                      "user_id": this.RNmessage.jyd_pubData.user_id, 
                      "source_type": this.RNmessage.jyd_pubData.source_type, 
                      "system_id": this.RNmessage.jyd_pubData.system_id, 
                      "network_type": this.RNmessage.jyd_pubData.network_type, 
                      "token_id": this.RNmessage.jyd_pubData.token_id
                    }
                  }
          window.location.href="http://10.2.0.155:8099/JYD_RN_Serv/personProLend/jumpUrl?"+"tel_phone="+this.RNmessage.tel_phone+"&sell_id="+this.objData.sellInfo.Id+"&jyd_pubData.user_id="+this.RNmessage.jyd_pubData.user_id+"&jyd_pubData.source_type="+this.RNmessage.jyd_pubData.source_type+"&jyd_pubData.system_id="+this.RNmessage.jyd_pubData.system_id+"&jyd_pubData.network_type="+this.RNmessage.jyd_pubData.network_type+"&jyd_pubData.token_id="+this.RNmessage.jyd_pubData.token_id   
        
      },
      showToastZoom(){
          this.hint = "出借金额不能大于200000元。"
          document.getElementById("text").blur();
          document.getElementById("toast").style.display="block"
          setTimeout(function(){
            document.getElementById("toast").style.display="none"
          },2000) 
      },
      changeCurrent(value){
        this.choose = value;
        this.scroll.refresh();
        if(value==2) {
           this.initConstituteData()
           this.$nextTick(() => {
             this.initConstituteScroll()
           });
         }else if(value==3) {
          this.initRecordData()
          this.$nextTick(() => {
            this.initRecordScroll()
          });
        }
      },
      initMainData(value){
        let vms = this
        let req = JSON.parse(JSON.stringify(value))
        //let req = JSON.parse(value)
        this.RNmessage = req
        let req1 = {
                    "sellInfoId": this.RNmessage.sellInfoId, 
                    "jyd_pubData": {
                      "user_id": this.RNmessage.jyd_pubData.user_id, 
                      "source_type": this.RNmessage.jyd_pubData.source_type, 
                      "system_id": this.RNmessage.jyd_pubData.system_id, 
                      "network_type": this.RNmessage.jyd_pubData.network_type, 
                      "token_id": this.RNmessage.jyd_pubData.token_id
                    }
                  }

       axios.post(axiosBaseUrl+"productDetails/querySellinDetail",req1).then(res=>{
          vms.objData = res.data
         /*  if(vms.objData.sellInfo.buyStatus!=="0"){
            vms.clickable=false;
          } */
          vms.income = (((vms.objData.sellInfo.MinInvestMoney*(vms.objData.sellInfo.ImproveYearRate + vms.objData.sellInfo.ExpectedYearYield)*vms.objData.sellInfo.ExpiresDays)/365).toFixed(2));
          vms.value1 = (vms.objData.sellInfo.ExpectedYearYield*100+vms.objData.sellInfo.ImproveYearRate*100).toFixed(2)
          vms.value2 = (vms.objData.sellInfo.ExpectedYearYield*100).toFixed(2)
          vms.value3 = (vms.objData.sellInfo.ImproveYearRate*100).toFixed(2)
          vms.value4 = (vms.objData.sellInfo.AccountFeeRate*100).toFixed(2)
          vms.value5 = (vms.objData.sellInfo.AdvanceWayValue*100).toFixed(2)
          vms.text1 = "最低出借"+vms.objData.sellInfo.MinInvestMoney+"元"
          console.log("vms.objData", vms.objData)
        }).catch(err=>{
          console.log(err)
        })
      },
      initConstituteData(){
        let vms = this
        let req ={
                  "SellLimitConfigId": this.objData.sellInfo.SellLimitConfigId, 
                  "jyd_pubData": {
                    "user_id": this.RNmessage.jyd_pubData.user_id, 
                    "source_type": this.RNmessage.jyd_pubData.source_type, 
                    "system_id": this.RNmessage.jyd_pubData.system_id, 
                    "network_type": this.RNmessage.jyd_pubData.network_type, 
                    "token_id": this.RNmessage.jyd_pubData.token_id
                  }
                }
        axios.post(axiosBaseUrl+"productObligatory",req).then(res=>{
          vms.listConstitute = res.data.borrows
          console.log(res)
        }).catch(err=>{
          
        })
      },
      initRecordData(){
        let vms = this
        let req = {
                  "SellLimitConfigId": this.objData.sellInfo.SellLimitConfigId, 
                  "PageNum":"1",
                  "jyd_pubData": {
                    "user_id": this.RNmessage.jyd_pubData.user_id, 
                    "source_type": this.RNmessage.jyd_pubData.source_type, 
                    "system_id": this.RNmessage.jyd_pubData.system_id, 
                    "network_type": this.RNmessage.jyd_pubData.network_type, 
                    "token_id": this.RNmessage.jyd_pubData.token_id
                  }
                }



        axios.post(axiosBaseUrl+"productJoinRecord",req).then(res=>{
          vms.listRecord = res.data.records
          console.log(res)
        }).catch(err=>{
          
        })
      },
      initMainScroll(){
        this.scroll = new window.BScroll(document.querySelector(".content"), {
          probeType: 2,
          click:true,
          momentum:false,
          pullUpLoad: true ,
         });
         this.scroll.on('touchEnd', this.mainScrollUp)
      },
      initConstituteScroll(){
        this.scrolls = new window.BScroll(document.querySelector(".contents"), {
          probeType: 2,
          click:true,
          momentum:false,
          pullUpLoad: true ,
         });
         this.scrolls.on('beforeScrollStart', this.mainScrollDisable)
         this.scrolls.on('touchEnd', this.mainScrollEnable)
       },
      initRecordScroll(){
        this.scrollss = new window.BScroll(document.querySelector(".contentss"), {
          probeType: 2,
          click:true,
          momentum:false,
          pullUpLoad: true ,
         });
         this.scrollss.on('beforeScrollStart', this.mainScrollDisable)
         this.scrollss.on('touchEnd', this.recordScrollUp)
      },
      mainScrollUp(pos){
        if(this.scroll.maxScrollY>pos.y+50){
            document.getElementById("bottom").style.display="block";
            this.scroll.refresh();
            this.scroll.scrollToElement(document.querySelector(".bottom"),800,0,0);
            this.scroll.off('touchEnd', this.mainScrollUp)
            this.scroll.on('touchEnd', this.mainScrollDown)
         } 
      },
      mainScrollDown(pos){
        var h = document.getElementById("top").offsetHeight
        if(pos.y>-h+20){
            this.scroll.scrollToElement(document.querySelector(".top"),800,0,0);
            this.scroll.off('touchEnd', this.mainScrollDown)
            this.scroll.on('touchEnd', this.mainScrollUp)
            document.getElementById("bottom").style.display="none";
            this.scroll.refresh();
          }
      },
      mainScrollDisable(){
        this.scroll.disable()
      },
      mainScrollEnable(){
        this.scroll.enable()
      },
      recordScrollUp(pos){
        this.mainScrollEnable()
        if(this.scrollss.maxScrollY>pos.y+50){
          this.recordPage++
          let vms = this
          let req = {
                    "SellLimitConfigId": this.objData.sellInfo.SellLimitConfigId, 
                    "PageNum":this.recordPage,
                    "jyd_pubData": {
                      "user_id": this.RNmessage.jyd_pubData.user_id, 
                      "source_type": this.RNmessage.jyd_pubData.source_type, 
                      "system_id": this.RNmessage.jyd_pubData.system_id, 
                      "network_type": this.RNmessage.jyd_pubData.network_type, 
                      "token_id": this.RNmessage.jyd_pubData.token_id
                    }
                  }



          axios.post(axiosBaseUrl+"productJoinRecord",req).then(res=>{
            var list = res.data.records
            vms.listRecord = vms.listRecord.concat(list)
            vms.$nextTick(() => {
              vms.scrollss.refresh();
           });
            vms.scrollss.refresh();
            console.log(res)
          }).catch(err=>{
            
          })
        }
        
      },
      init(){
        let vms = this
        var str = {"tel_phone":"15822753827","tel_code":"","tel_pwd":"","refer_code":"","jyd_pubData":{"user_id":39,"user_name":"","source_type":"0001","system_id":"Apple ios 11.4","network_type":"wifi","token_id":"123235h5e3"},"PageNum":"1","sellInfoId":"JE0902018072001"}
        vms.initMainData(str)
        window.onload = function () {
            document.addEventListener('message', function (e) {
                //document.getElementById('data').textContent = e.data;
                vms.initMainData(e.data)
            })
            
        }
        var refreshIntervalId = setInterval(function(){
            if (window.originalPostMessage) {
              
                stop();
            } 
        }, 500);

        function stop(){
            window.postMessage("");
            clearInterval(refreshIntervalId);
        }
       
       
       }
      
    },
    created() {
      //this.initMainData();
    },
    mounted() {
      document.getElementById("top").style.minHeight = (document.documentElement.clientHeight+10)+"px";
      document.getElementById("bottom").style.minHeight = (document.documentElement.clientHeight)+"px";
      this.init()
      this.$nextTick(() => {
        this.initMainScroll();
        this.h1=window.innerHeight
      });
    },
  })
</script>
</body>
</html>