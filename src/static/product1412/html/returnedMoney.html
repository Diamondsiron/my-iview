<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../js/vue.min.js"></script>
    <script src="../js/axios.min.js"></script>
    <script src="../js/axios.config.js"></script>
    <script src="../js/bscroll.min.js"></script>
    <link rel="stylesheet" href="../css/returnedMoney.css">
    <title>Document</title>
</head>
<body>
<div id="main">
    <div>
        <article id="article" >
			<div class="content" style="height:100%;" id="content">
				<div>
					
					<div class="card" v-for="(item,index) in list" ::key="item">
							<div>{{item.return_no}}</div>
							<div>{{item.repay_status}}</div>
							<div>应还本金</div>
							<div>{{item.principal}}</div>
							<div>应还利息</div>
							<div>{{item.interest}}</div>
							<div>总款金额</div>
							<div>{{item.total_return}}</div>
						</div>
					
						
				</div>
				
			</div>
            
        </article>
    </div>
</div>
<script>
	document.documentElement.style.fontSize = document.documentElement.clientWidth / 1242*100 + 'px';
	var vm = new Vue({
		el:"#main",
		data(){
			return{
				choose:1,
				list:[],
				page1:1,
				scroll:{},
				RNmessage:{}
			}
		},
		methods:{
			initMainScroll(){
				this.scroll = new window.BScroll(document.querySelector(".content"), {
				probeType: 2,
				click:true,
				momentum:false,
				pullUpLoad: true ,
				
				});
				this.scroll.on('touchEnd', this.mainScrollUp)
			},
			mainScrollUp(pos){
				let vms = this
				if(vms.scroll.maxScrollY>pos.y+50){
					vms.page++
					let req = {
						"page_number": vms.page,
						"borrow_id": vms.RNmessage.borrow_id,
						"jyd_pubData": {
							"user_id": vms.RNmessage.jyd_pubData.user_id,
							"source_type": vms.RNmessage.jyd_pubData.source_type,
							"system_id": vms.RNmessage.jyd_pubData.system_id,
							"network_type": vms.RNmessage.jyd_pubData.network_type,
							"token_id": vms.RNmessage.jyd_pubData.token_id
						}
					}
					axios.post(axiosBaseUrl+"productMore/returnPlan",req).then(res=>{
							
							vms.list=vms.list.concat(res.data.record_list)
							vms.$nextTick(() => {
								vms.scroll.refresh()
							});
					}).catch(err=>{

					})
				}
			},
			initData(){
				let vms = this
				let req = {
					"page_number": "1",
					"borrow_id": vms.RNmessage.borrow_id,
					"jyd_pubData": {
						"user_id": vms.RNmessage.jyd_pubData.user_id,
						"source_type": vms.RNmessage.jyd_pubData.source_type,
						"system_id": vms.RNmessage.jyd_pubData.system_id,
						"network_type": vms.RNmessage.jyd_pubData.network_type,
						"token_id": vms.RNmessage.jyd_pubData.token_id
					}
				}
				axios.post(axiosBaseUrl+"productMore/returnPlan",req).then(res=>{
					
					vms.list = res.data.record_list
					vms.list = [0,1,2,3,4,5,6,7,8,9]
					vms.$nextTick(() => {
						vms.initMainScroll();
						
					});
			}).catch(err=>{

				})
			},
			init(){
				let vms = this
				//本地测试用这段代码
                var str = {
                 "page_number": "1",
                 "borrow_id": "20180825020450010086",
                 "jyd_pubData": {
                 "user_id": 2,
                 "source_type": "0001",
                 "system_id": "Android 7",
                 "network_type": "wifi",
                 "token_id": "123235h5e3"
                 }
                 }
                 vms.RNmessage = JSON.parse(JSON.stringify(str))
                 vms.initData()
				//分割线
				window.onload = function () {
					document.addEventListener('message', function (e) {
						vms.RNmessage = JSON.parse(e.data)
						vms.initData()
					})
				}

				var refreshIntervalId = setInterval(function(){
					if (window.originalPostMessage) {
						stop();
					}
				}, 500);

				function stop(){
					let message = {key:'1',val:{name:'首次打开'}}
					window.postMessage(JSON.stringify(message));
					clearInterval(refreshIntervalId);
				}
			}
		},
		mounted() {
			document.getElementById("article").style.height = (document.documentElement.clientHeight)+"px";
			this.init()
		},
	})
</script>
</body>
</html>